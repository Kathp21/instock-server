const knex = require('knex')(require('../knexfile'));

const index = async (req, res) => {
    try {
        const data = await knex('inventories')
        res.status(200).json(data)
    } catch(err) {
        res.status(400).send(`Error retrieving Inventories: ${err}`)
    }
}

//POST add new inventory
const add = async (req,res) => {
    console.log('hello 11')
    if (!req.body.item_name || !req.body.category) {
        return res.status(400).json({
            message: "Please provide name and category for the new inventory",
        })
    }

    try {
        const result = await knex("inventories").insert(req.body)
        console.log('Insert result:', result);
        const newInventoryId = result[0]
        const createdInventory = await knex("inventories").where({id: newInventoryId })
        console.log('Created inventory:', createdInventory);
        res.status(201).json(createdInventory)
    } catch(error) {
        res.status(500).json({
            message: `Unable to create new inventory: ${error}`
        })
    }
}


const deleteInventoryItem = async (req, res) => {
    const { id } = req.params; 
    
    try {
        const deletedCount = await knex('inventories') 
            .where({ id })
            .del();
        
        if (deletedCount === 0) {
            
            return res.status(404).end();
        }

        res.status(204).end();
    } catch (error) {
        console.error(error);
        res.status(500).send('Server error');
    }
};
module.exports = { index, deleteInventoryItem, add }
